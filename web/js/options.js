var loggedInUser,CLIENT_ID="453486582246-qr4dr1lbclp9149pead96tbtetuvcduj.apps.googleusercontent.com",API_KEY="AIzaSyBPUJKB5QecgWwtdU4CmX9SrDnXpf0V3w8",daysDiff=314496e5,DISCOVERY_DOCS=["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],SCOPES="https://www.googleapis.com/auth/drive profile email",authorizeButton=document.getElementById("authorize_button"),signoutButton=document.getElementById("signout_button");function handleClientLoad(){gapi.load("client:auth2",initClient)}function initClient(){gapi.client.init({apiKey:API_KEY,clientId:CLIENT_ID,discoveryDocs:DISCOVERY_DOCS,scope:SCOPES}).then(function(){gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus),updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get()),authorizeButton.onclick=handleAuthClick,signoutButton.onclick=handleSignoutClick})}function updateSigninStatus(e){e?(loggedInUser="+"+gapi.auth2.getAuthInstance().currentUser.Ab.w3.U3,$(authorizeButton).addClass("hidden"),$(signoutButton).removeClass("hidden"),$(".table-inbox").removeClass("hidden"),makeTableSortable(),listFiles()):($(signoutButton).addClass("hidden"),$(authorizeButton).removeClass("hidden"),$(".table-inbox").addClass("hidden"))}function handleAuthClick(e){gapi.auth2.getAuthInstance().signIn({scope:"profile email"}).then(function(e){try{loggedInUser="+"+e.w3.U3}catch(e){console.log("error",e)}})}function handleSignoutClick(e){gapi.auth2.getAuthInstance().signOut()}function appendPre(e,t){var n=e.mimeType,i='<tr>\t\t\t<td><a target="_blank" href="'+(n.indexOf("application/vnd.google-apps")>-1?"https://docs.google.com/"+(n=n.replace("application/vnd.google-apps.",""))+"/d/"+e.id+"/edit":"https://drive.google.com/file/d/"+e.id+"/edit")+'">'+e.name+"</a></td>\t\t\t<td>"+formatDate(t.createdTime)+"</td>\t\t\t<td>\t\t\t"+t.content+'</td>\t\t\t<td>\t\t\t\t<button data-dismiss="modal" data-toggle="modal" data-target="#reply-modal" \t\t\t\t\tid="'+t.id+'" class="btn btn-primary" onclick="fillInReply(\''+e.name+"','"+escape(t.content)+"',this.id,'"+e.id+'\')">\t\t\t\tReply</button>\t\t\t<button id="resolve-'+t.id+'"  class="btn btn-primary" onclick="markAsResolved(\''+t.id+"','"+e.id+"')\"> Mark As Resolved</button>\t\t\t</td>\t\t\t</tr>";$(".table-inbox").DataTable().row.add($(i)).draw()}function markAsResolved(e,t){gapi.client.drive.replies.create({fileId:t,commentId:e,fields:"content",action:"resolve",content:"resolved"}).execute(function(t){console.log(t),"resolved"===t.content&&$("#resolve-"+e+",#"+e).attr("disabled","disabled")})}function sendReply(){return $("#reply-button").addClass("disabled"),sendMessage($("#reply-message-id").attr("fileId"),$("#reply-message-id").val(),$("#reply-message").val(),replyTidy),!1}function replyTidy(e){console.log("reply response "+e),$("#reply-modal").modal("hide"),$("#reply-message").val(""),$("#reply-button").removeClass("disabled")}function fillInReply(e,t,n,i){$("#reply-to").val(e),$("#reply-subject").val(unescape(t)),$("#reply-message-id").val(n),$("#reply-message-id").attr("fileId",i)}function sendMessage(e,t,n,i){return gapi.client.drive.replies.create({fileId:e,commentId:t,fields:"content",content:n}).execute(i)}function listFiles(){$(".table-inbox tbody").empty();var e=loadAllFiles,t=new Date(new Date-daysDiff).toISOString().split(".")[0],n=function(i,a){i.execute(function(o){o.files=o.files||[],a=a.concat(o.files);var l=o.nextPageToken;l?(i=gapi.client.drive.files.list({q:"modifiedTime > '"+t+"'",pageSize:1e3,pageToken:l,userIp:"ActionItemsManager",fields:"nextPageToken, files(id, name, mimeType)"}),n(i,a)):e(a)})},i=gapi.client.drive.files.list({q:"modifiedTime > '"+t+"'",pageSize:1e3,userIp:"ActionItemsManager",fields:"nextPageToken, files(id, name, mimeType)"});n(i,[])}function loadAllFiles(e){if(e&&e.length>0)for(var t=0;t<e.length;t++){var n=e[t];n.id,n.name;listAllComments(n,t==e.length-1)}else appendPre("No files found.")}function listAllComments(e,t){var n,i,a=e.id,o=loadAllComments,l=new Date(new Date-daysDiff).toISOString(),s=gapi.client.drive.comments.list({fileId:a,startModifiedTime:l,pageSize:100,userIp:"ActionItemsManager",fields:"nextPageToken, comments(id,content,htmlContent,resolved,createdTime)"});i=[],(n=s).execute(function(s){s.comments=s.comments||[],i=i.concat(s.comments);var d=s.nextPageToken;d?(n=gapi.client.drive.comments.list({fileId:a,pageSize:100,startModifiedTime:l,pageToken:d,userIp:"ActionItemsManager",fields:"nextPageToken, comments(id,content,htmlContent,resolved,createdTime)"}),getPageOfFiles(n,i)):o(e,i,t)})}function makeTableSortable(){try{$(".table-inbox").DataTable().clear(),$(".table-inbox").DataTable().destroy()}catch(e){console.log(e)}$(".table-inbox").DataTable({paging:!1,iDisplayLength:"All",bInfo:!1,order:[[1,"desc"]]})}function formatDate(e){var t="";try{t=e.replace("T"," ").split(".")[0]}catch(e){t=""}return t}function loadAllComments(e,t){if(t&&t.length>0){console.log(t);for(var n=0;n<t.length;n++){var i=t[n],a=i.content;!i.resolved&&a.indexOf(loggedInUser)>-1&&(i.content=a,appendPre(e,i))}}}function sleep(e){for(var t=(new Date).getTime(),n=0;n<1e7&&!((new Date).getTime()-t>e);n++);}